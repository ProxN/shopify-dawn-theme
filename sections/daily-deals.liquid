{% comment %} Please do not edit this file. It is automatically updated by Daily Deals{% endcomment %}

{% assign dealOfTheDayProduct = collections[shop.metafields.daily_deals.collection_handle].products[0] %}

{% if dealOfTheDayProduct  %}
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-124636115-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-124636115-5');
</script>
<script>
  // createSession();
</script>
<div style="margin: 0 auto; margin-top: 20px; margin-bottom: 20px; max-width:{{section.settings.maxwidth}}px;">
    <h1 class="daily__deals_heading"> {{ section.settings.text-box }} </h1>
    <div class="daily__deals_deal_of_the_deal_box_wrapper">
      <div class="daily_deals__deals_box">
        <div class="daily_deals__deals_box_col_image">
          <div class="daily_deals__featured_image_box">
            <img style="max-width: 100%" src="{{ dealOfTheDayProduct.featured_image.src | img_url: "large" }}"
                  alt="{{ dealOfTheDayProduct.featured_image.alt }}" />
          </div>
        </div>
        <div class="daily_deals__deals_box_col_price">
          <div class="daily_deals__price_box_wrapper">
            <h2><a href="/products/{{ dealOfTheDayProduct.handle }}">{{ dealOfTheDayProduct.title }}</a></h2>
            <div class="daily_deals__deals_price">
              <h5>Deal Of The Day Price</h5>
              <div class="daily_deals_price">
                <h3>{{ dealOfTheDayProduct.price_min | money }}</h3>
                <div class="daily_deals__offers">
                  <p class="daily_deals__reg">Regular price:
                    <span>{{ dealOfTheDayProduct.compare_at_price_min | money }}</span>
                  </p>
                  <p class="daily_deals__pr">You save:
                    <span>{{ dealOfTheDayProduct.compare_at_price_min | minus: dealOfTheDayProduct.price_min | money }}</span>
                  </p>
                </div>
              </div>
              <div class="hide-desktop" id="countdown-text">{{ section.settings.countdown-heading }} <span id="daily_deals__countdown"></span></div>
            </div>

            <form method="post" action="/cart/add">
              <div class="deal__option__select">
                {%- unless dealOfTheDayProduct.has_only_default_variant -%}
                {%- for option in dealOfTheDayProduct.options_with_values -%}
                <div class="form__group w-50">
                  <label for="ProductSelect-option-{{ forloop.index0 }}">
                    {{ option.name | escape }}
                  </label>
                  <select onchange="changeVariant()" class="form__control"
                          style="display: block;" id="ProductSelect-{{ forloop.index0 }}"
                          data-index="option{{ forloop.index }}">
                    {%- for value in option.values -%}
                    <option id="single-option" value="{{ value | escape }}"
                            {% if option.selected_value == value %} selected="selected" {% endif %}>
                      {{ value | escape }}
                    </option>
                    {%- endfor -%}
                  </select>
                </div>
                {%- endfor -%}
                {%- endunless -%}
                <input type="hidden" id="quantity" name="quantity" value="1" />
                <select style="display: none;" id="VariantIds"
                        onchange="changeVariant()"
                        class="product-form__variants no-js" name="id"
                        data-productid="{{dealOfTheDayProduct.id}}">
                  {% for option in dealOfTheDayProduct.variants %}
                    <option value="{{option.id}}">{{option.title}}</option>
                  {% endfor %}
                </select>
              </div>
              <div id="available-variant" class="daily_deals__btn-holder">
                <button id="atc-main"
                        type="submit"
                        onclick="gtag('event', 'add_to_cart_section', { 'event_category': '{{ shop.domain }}' })"
                        class="daily_deals__cta daily_deals__cta-cart l__screen">Add To Cart</button>
                <button id="buy-now-main"
                        type="button"
                        onclick="buyNow({{ dealOfTheDayProduct.variants[0].id }})"
                        style="color: {{ section.settings.button-font-color }}; background: {{ section.settings.button-color }}; border: 1px solid {{ section.settings.button-color }};"
                        class="daily_deals__cta daily_deals__cta-primary">Buy Now</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div style="background: {{ section.settings.countdown-background-color }}"
            class="daily_deals__countdown_box">
        <div style="background: {{ section.settings.countdown-background-inner-color }}"
             class="daily_deals__card-timer hide-mobile">
          <div class="daily_deals__text-lg">
            <h2 style="color: white;">{{ section.settings.countdown-heading }}</h2>
          </div>
          <div class="daily_deals__text-sm">
<!--               <h2>{{ section.settings.countdown-heading }}</h2> -->
          </div>
          <ul class="daily_deals__timer">
            <li>
              <span style="background: {{ section.settings.countdown-box-colors }}; color: {{ section.settings.countdown-box-font-colors }};"
                    id="lead-product-hours"
                    class="daily_deals__counter"></span>
              <span class="daily_deals__format" style="color: white;">Hours</span>
            </li>
            <li>
              <span style="background: {{ section.settings.countdown-box-colors }}; color: {{ section.settings.countdown-box-font-colors }};"
                    id="lead-product-minutes"
                    class="daily_deals__counter"></span>
              <span class="daily_deals__format" style="color: white;">Minutes</span>
            </li>
            <li>
              <span style="background: {{ section.settings.countdown-box-colors }}; color: {{ section.settings.countdown-box-font-colors }};"
                    id="lead-product-seconds"
                    class="daily_deals__counter"></span>
              <span class="daily_deals__format" style="color: white;">Seconds</span>
            </li>
          </ul>
        </div>
        <div class="daily_deals__subscribtion-card">
          <h3 style="color: {{ section.settings.sign-up-font-colors }};">{{ section.settings.sign-up-heading }}</h3>
          <p style="color: {{ section.settings.sign-up-font-colors }};">{{ section.settings.sign-up-subheading }}</p>
          <div class="daily_deals__form-group">
            <input id="subscriberData"
                    type="tel"
                    autocomplete="tel"
                    class="daily_deals__form-input"
                    placeholder="{{ section.settings.sign-up-type }}">
            <div class="daily_deals__btn-group">
              <button id="subscribe-button"
                      style="background: {{ section.settings.button-color }}; color: {{ section.settings.button-font-color }};"
                      onclick="submitSubscribeForm()">Subscribe</button>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>
<script>
    async function createSession() {
      const sessionExists = sessionStorage.getItem('deals-page-session-id') || false;
      if (!sessionExists) {
        const sessionRequest = await fetch('https://api.dailydeals.ai/session/create?shop=' + Shopify.shop, {
          method: 'POST',
          headers: {
            Accept: 'application/json',
            'Content-Type': 'application/json',
          },
        });
        const sessionResponse = await sessionRequest.json();
        const sessionId = sessionResponse.sessionId;
        sessionStorage.setItem('deals-page-session-id', sessionId);
      }
    }

    createSession();

    function countdown() {
      const endTime = {{ dealOfTheDayProduct.metafields.daily_deals.endtime }};
      const now = new Date().getTime();
      const distance = endTime - now;
      const days = Math.floor(distance / (1000 * 60 * 60 * 24)); // === 0 ? "" : Math.floor(distance / (1000 * 60 * 60 * 24)) + "d ";
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)) >= 10 ? Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)) : '0' + Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)) >= 10 ? Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)) : '0' + Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000) >= 10 ? Math.floor((distance % (1000 * 60)) / 1000) : '0' + Math.floor((distance % (1000 * 60)) / 1000);

      document.getElementById("daily_deals__countdown").innerHTML = `${days ? days + "h" : ""} ${hours}h ${minutes}m ${seconds}s`;
      document.getElementById("lead-product-hours").innerHTML = `${hours}`;
      document.getElementById("lead-product-minutes").innerHTML = `${minutes}`;
      document.getElementById("lead-product-seconds").innerHTML = `${seconds}`;


      if (distance < 0) {
        clearInterval(x);
        document.getElementById("countdown-text").innerHTML = "Deal Ended";
        // document.getElementById("daily_deals__countdown").innerHTML = "";
        var ddCountdown = document.getElementById("daily_deals__countdown");
        if (ddCountdown) ddCountdown.innerHTML = "";
      }
    }
    countdown();
    var x = setInterval(countdown, 1000);

    function changeVariant() {
      const selectedVariantString = Array.prototype.slice
      .call(document.querySelectorAll("[id^='ProductSelect']"))
      .map(input => input.value).join(" / ");

      document.getElementById("VariantIds").selectedIndex = Array.prototype.slice
      .call(document.querySelector("[id^='VariantIds']").options)
      .map(option => option.innerHTML).indexOf(selectedVariantString);
    }

    function buyNow(variantId) {
      window.location.href = `/cart/${document.getElementById("VariantIds").value}:1?ref=daily_deals_page` || variantId;

      gtag('event', 'begin_checkout_section', { 'event_category': Shopify.shop });
    }
    async function submitSubscribeForm() {
      const phoneNumber = document.getElementById('subscriberData').value;
      const submitRequest = await fetch(`https://api.dailydeals.ai/v2/subscriber/create?phoneNumber=${phoneNumber}&shopify_domain=${Shopify.shop}`, {
          method: 'POST'
      });

      if (submitRequest.status === 400) return alert("Invalid phone number");

      const subscribeButton = document.getElementById('subscribe-button');

      subscribeButton.disabled = true;
      subscribeButton.innerHTML = "Subscribed!";
      subscribeButton.style.background = "#C5CBD5";
      subscribeButton.style.color = "#000000";
      subscribeButton.style.opacity = 0.6;
      subscribeButton.style.cursor = "not-allowed";

      gtag('event', 'sign_up_section', { 'event_category': Shopify.shop });
    }
</script>
{% endif %}
{% schema %}
{
  "name": "Deal Of The Day",
  "settings": [
    {
      "type": "range",
      "id": "maxwidth",
      "min": 1080,
      "max": 1300,
      "step": 20,
      "unit": "px",
      "label": "Maximum width",
      "default": 1200
    },
  {
      "id": "text-box",
      "type": "text",
      "label": "Heading",
      "default": "Deal Of The Day"
    },
    {
      "id": "button-color",
      "type": "color",
      "label": "Button Color",
      "default": "#000000"
    },
    {
      "id": "button-font-color",
      "type": "color",
      "label": "Button Font Color",
      "default": "#ffffff"
    },
    {
      "id": "countdown-background-color",
      "type": "color",
      "label": "Countdown Box Background Color",
      "default": "#2D2D2D"
    },
    {
      "id": "countdown-background-inner-color",
      "type": "color",
      "label": "Countdown Box Background Inner Color",
      "default": "#000000"
    },
    {
    "id": "countdown-heading",
        "type": "text",
        "label": "Countdown Box Heading",
        "default": "Ends In:"
      },
    {
      "id": "countdown-box-colors",
      "type": "color",
      "label": "Countdown Box Colors",
      "default": "#2D2D2D"
    },
    {
      "id": "countdown-box-font-colors",
      "type": "color",
      "label": "Countdown Box Font Colors",
      "default": "#ffffff"
    },
    {
    "id": "sign-up-heading",
      "type": "text",
      "label": "Sign Up Heading",
      "default": "Stay Connected"
    },
    {
    "id": "sign-up-subheading",
      "type": "text",
      "label": "Sign Up Subeading",
      "default": "Stay informed on the latest deals and events from us."
    },
    {
      "id": "sign-up-font-colors",
      "type": "color",
      "label": "Sign Up Font Colors",
      "default": "#ffffff"
    },
    {
    "id": "sign-up-type",
      "type": "select",
      "label": "Collection Type",
    "options": [
      {
          "group": "Collection Type",
          "value": "Email address",
          "label": "Email Addresses"
      },
      {
          "group": "Collection Type",
          "value": "Phone number",
          "label": "Phone Numbers"
      }
    ],
      "default": "Email address"
    }
  ],
  "presets": [
    {
      "name": "Deal Of The Day",
      "category": "Daily Deals"
    }
  ]
}
{% endschema %}

{% stylesheet %}
.daily__deals_deal_of_the_deal_box_wrapper {
display: flex;
}

.daily_deals__deals_box {
width: 80%;
display: flex;
}

.daily_deals__deals_box_col_image {
width: 40%;
}

.daily_deals__deals_box_col_price {
width: 60%;
}

.daily_deals__price_box_wrapper {
padding: 32px;
}

.daily_deals__countdown_box {
width: 38%;
background: black;
padding: 29px 41px 40px;
}

.daily_deals__deals_price {
margin-top: 45px;
}

.daily_deals__deals_price h5 {
font-size: 14px;
font-weight: 700;
margin-bottom: 4px;
}

.daily_deals_price {
display: flex;
align-items: center;
}

.daily_deals__deals_price .daily_deals_price h3 {
font-weight: 700;
font-size: 46px;
line-height: 47px;
margin-right: 10px;
margin-top: 0px;
margin-bottom: 0px;
}

.daily_deals__offers {
margin-bottom: 14px;

}

.daily_deals__offers p {
line-height: 19px;
font-size: 14px;
margin: 0px;
}

.daily_deals__offers p.daily_deals__reg {
color: rgba(0, 0, 0, 0.4);
}

.daily_deals__offers p.daily_deals__reg span {
text-decoration: line-through;
}

.daily_deals__offers p.daily_deals__pr span {
font-weight: 700;
}

.daily_deals__btn-holder .daily_deals__cta {
margin-top: 12px;
}

.daily_deals__btn-holder {
  display: flex;
  flex-direction: column;
}

.daily_deals__cta-cart {
  border: 1px solid rgba(36,36,36,0.5) !important;
  color: rgba(36,36,36,0.5);
  background: rgba(0,0,0,0);
}

.daily_deals__cta {
width: 100%;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
  font-weight: 700;
  font-size: 14px;
  line-height: 14px;
  padding: 10px;
}

.deal__option__select {
  margin: 10px -7px 0;
}

.deal__option__select {
  display: flex;
}

.deal__option__select .form__group {
  padding: 0 7px;
}

.deal__option__select .w-50 {
  width: 50%;
}

.form__group label {
  font-weight: 700;
  margin-bottom: 5px;
}

select.form__control {
  width: 100%;
  -webkit-appearance: none;
  appearance: none;
  background-image: url(https://api.dailydeals.ai/public/images/down-arrow.svg);
  background-repeat: no-repeat;
  background-size: 11px;
  background-position: 92% center;
  text-align: left;
  text-align-last: left;
  border: 1px solid rgba(36,36,36,0.5);
}

.form__control {
  width: 100%;
  height: 37px;
  padding: 2.5px 15px;
}

.daily_deals__card-timer {
  background: #000000;
  padding: 31px;
  margin-bottom: 13px;
}

.daily_deals__card-timer h2 {
  font-weight: 700;
  font-size: 22px;
  line-height: 26px;
  text-align: center;
  max-width: 206px;
  margin: 0 auto 22px;
}

.daily_deals__timer {
  display: flex;
  align-items: center;
  margin: 0 -16px;
  padding-left: 0px !important;
}

.daily_deals__timer li {
  flex: 1;
  text-align: center;
  display: flex;
  flex-direction: column;
  /* padding: 0 16px; */
}

.daily_deals__timer li span.daily_deals__counter {
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 80px;
  font-size: 40px;
  line-height: 52px;
  margin-bottom: 6px;
  padding: 0 10px;
  width: 85%;
  margin: auto;
  max-width: 120px;
}

.daily_deals__timer li span.daily_deals__format {
  margin-top: 4px;
  font-size: 16px;
  line-height: 19px;
}

.daily_deals__timer li span {
  font-weight: 700;
  text-align: center;
  color: #ffffff;
  display: block;
}

.daily_deals__subscribtion-card h3 {
  font-weight: 700;
  font-size: 22px;
  line-height: 26px;
  text-align: center;
  margin-bottom: 7px;
}

.daily_deals__subscribtion-card p {
  font-size: 16px;
  line-height: 19px;
  text-align: center;
  opacity: 0.7;
  max-width: 289px;
  margin: 0 auto 16px;
}

.daily_deals__form-group {
  display: flex;
}

.daily_deals__form-group .daily_deals__form-input {
  width: 100%;
  height: 50px;
  background: rgba(255, 255, 255);
  border: none;
  font-size: 12px;
  line-height: 14px;
  padding: 15px;
  border-radius: 0%;
}

.daily_deals__form-group .daily_deals__btn-group button {
  height: 50px;
  background: #FFFFFF;
  border: none;
  font-size: 14px;
  line-height: 14px;
  font-weight: 700;
  text-align: center;
  color: #000000;
  min-width: 100px;
  padding: 15px;
}

#countdown-text {
font-size: 14px;
font-weight: 700;
margin-top: 4px;
}

@media(min-width: 1080px) {
.hide-desktop {
  display: none;
}
}

@media(max-width: 1080px) {
.daily__deals_deal_of_the_deal_box_wrapper {
  display: block;
}

.daily__deals_heading {
  text-align:
}

.daily_deals__featured_image_box {
  text-align: center;
}

.daily_deals__deals_box {
  display: block;
  width: 100%;
}

.daily_deals__offers {
  margin-bottom: 0px;
}

.daily_deals__deals_box_col_image {
  width: 100%;
}

.daily_deals__deals_box_col_price {
  width: 100%;
}

.daily_deals__countdown_box {
  width: 100%;
}

.hide-mobile {
  display: none;
}
}

{% endstylesheet %}